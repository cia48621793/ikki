!function(e){function t(e,t){return t?(Object.keys(t.query).map(function(n){e=e.replace(new RegExp("^\\?"+n+"$"),t.query[n])}),Object.keys(t.param).map(function(n){e=e.replace(new RegExp("^\\$"+n+"$"),t.param[n])}),e):e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){return regeneratorRuntime.mark(function n(){var r,o,i,a=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=new u,o=t(a.path||"",a.query||{},a.param||{}),i=o.next().value,i.listeners=[{key:e,callback:function(e){var t=o.next(e).value;t&&(r.resolve(t),r=new u)}}],n.next=6,i;case 6:return n.next=9,r.promise;case 9:n.next=6;break;case 11:case"end":return n.stop()}},n,this)})}function o(e,t){function n(e){i&&(e.listeners=o,i=!1),r.resolve(e),r=new u}var r,o=[],i=!0;return Object.keys(t).map(function(e){o.push({key:e,callback:t[e].bind(this,n)})}),regeneratorRuntime.mark(function a(){var t=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:r=new u,setTimeout(function(){e(n,t.path||"",t.query||{},t.param||{}),i&&n({})},0);case 2:return o.next=4,r.promise;case 4:o.next=2;break;case 5:case"end":return o.stop()}},a,this)})}var i=e&&e.riot?e.riot:require("riot");i.tag("route",' <section if="{ show }"><yield ></yield></section>',function(e){function t(e,t){if(e=e.replace(/^\//,""),"*"==e)return{};var n=[],r=e.replace(/(^|\/):([^\/]+)/g,function(e,t,r){return n.push(r),t+"([^/]+)"}),o=t.match(new RegExp("^"+r+"$"));if(!o)return null;var i={};return n.map(function(e,t){i[e]=o[t+1]}),i}var n=this;n.show=!1,n.on("update",function(){var r,o=n.parent.path,i=n.parent.query;n.show=!n.parent.found&&null!==(r=t(e.path,o)),r=r||{},n.show&&(e.redirect?/^http/.test(e.redirect)?location.href=e.redirect:location.hash=e.redirect:(n.trigger("urlchanged",{path:o,query:i,param:r}),n.parent.found=!0))}),n._ownPropKeys=[],n._ownOptsKeys=[];for(var r in n)n._ownPropKeys[r]=!0;for(var r in n.opts)n._ownOptsKeys[r]=!0;n.on("update",function(){var e=this.parent.parent;if(e){for(var t in e)this._ownPropKeys[t]||(this[t]=e[t]);for(var t in e.opts)this._ownOptsKeys[t]||(this.opts[t]=e.opts[t])}})}),i.tag("router"," <yield ></yield>",function(t){var n=this,r=e,o="hashchange";n.path="",n.query={},n.found=!1,this.emit=function(e){var t=location.href.split("#")[1]||"",r=t.split("?")[0].replace(/^\/|\/$/g,""),o={};t.replace(/[?&](.+?)=([^&]*)/g,function(e,t,n){o[t]=n}),n.path=r,n.query=o,n.found=!1,e&&n.update()}.bind(this),n.on("mount",function(){r.addEventListener?r.addEventListener(o,n.emit,!1):r.attachEvent("on"+o,n.emit)}),n.on("unmount",function(){r.removeEventListener?r.removeEventListener(o,n.emit,!1):r.detachEvent("on"+o,n.emit)}),n.emit()}),i.mixin("ikki",{$$version:0,init:function(){var e=this,n=e.$$findAncestor("route");n?n.on("urlchanged",function(n){e.$$loadOpts(e.opts.opts,n),e.one("update",function(){Object.keys(e.opts).map(function(r){"string"==typeof e.opts[r]&&(e.opts[r]=t(e.opts[r],n))})})}):e.$$loadOpts(e.opts.opts)},$$findAncestor:function(e){for(tag=this;tag&&e!=tag.root.tagName.toLowerCase();)tag=tag.parent;return tag||null},$$loadOpts:function(e,t){function n(e){function t(t){o<r.$$version||(r.$$extendOpts(t)&&r.update(),setTimeout(function(){n(e)},0))}var i=e.next().value;i&&(i.then?i.then(t):t(i))}if(e){var r=this,o=++r.$$version;"object"!=typeof e||e.then?"object"==typeof e?e.then(function(e){r.$$extendOpts(e)&&r.update()}):e&&"GeneratorFunction"==e.constructor.name?n(t?e(t):e()):"function"==typeof e&&r.$$extendOpts(e(t)):r.$$extendOpts(e)}},$$extendOpts:function(e){var t=this;e.listeners&&(e.listeners.map(function(e){t.on(e.key,e.callback)}),delete e.listeners);var n=Object.keys(e);return n.map(function(n){t.opts[n]=e[n]}),n.length>0}});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(){var t=this;n(this,e),this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return a(e,[{key:"resolve",value:function(e){this._resolve(e)}},{key:"reject",value:function(e){this._reject(e)}}]),e}(),s=function(){function e(){n(this,e)}return a(e,[{key:"direction",value:function(e,t,n){}},{key:"push",value:function(e){this.deferred.resolve(e),this.deferred=new u}},{key:"error",value:function(e){this.deferred.reject(e),this.deferred=new u}},{key:"start",value:function(){var e=this;return regeneratorRuntime.mark(function t(){var n=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.deferred=new u,setTimeout(function(){e.direction(n.path||"",n.query||{},n.param||{})},10);case 2:return t.next=5,e.deferred.promise;case 5:t.next=2;break;case 7:case"end":return t.stop()}},t,this)})}},{key:"stop",value:function(){var e=void 0===arguments[0]?{}:arguments[0];this.push(e)}},{key:"on",value:function(e,t){var n=this;setTimeout(function(){n.push({listeners:[{key:e,callback:t}]})},1e3)}}]),e}();"object"==typeof exports&&(module.exports={Deferred:u,edo:r,kyoto:o,Nara:s})}("undefined"!=typeof window?window:void 0);